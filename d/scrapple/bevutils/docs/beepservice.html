<html><head>
	<META http-equiv="content-type" content="text/html; charset=utf-8">
	<title>bevutils.beepservice</title>
	</head><body>
	<h1>bevutils.beepservice</h1>
	<!-- Generated by Ddoc from beepservice.d -->
<b>Authors:</b><br>
Steve Teale - steve.teale@britseyeview.com

<br><br>
<b>Date:</b><br>
2007/05/19
<br><br>
<b>History:</b><br>
V0.1
<br><br>
<b>License:</b><br>
Use freely for any purpose.
<br><br>

 This is an example of a service built on class ServiceImplementation.
 
<br><br>

<dl><dt><big>class <u>BeepWorker</u>: bevutils.serviceimplementation.WorkerThread;
</big></dt>
<dd>To implement the service you must implement one or more classes derived from interface WorkerThread
 and a class derived from ServiceImplementation.
 You must also provide a stereotyped version of main().
<br><br>
<pre class="d_code"><font color=blue>class</font> <u>BeepWorker</u> : WorkerThread
{
   Log4D _log;
   ServiceImplementation _si;
   EventLogger _elog;
   PropertyFile _props;
   <font color=blue>uint</font> _frequency;
   <font color=blue>uint</font> _duration;

   <font color=blue>this</font>(<font color=blue>uint</font> freq, <font color=blue>uint</font> dur)
   {
      _frequency = freq;
      _duration = dur;
   }

   <font color=blue>void</font> setLog(Log4D log) { _log = log; }
   <font color=blue>void</font> setHost(ServiceImplementation si) { _si = si; }
   <font color=blue>void</font> setProperties(PropertyFile pf) { _props = pf; }
   <font color=blue>void</font> setEventLogger(EventLogger el) { _elog = el; }
   <font color=blue>char</font>[] threadName() { <font color=blue>return</font> <font color=red>"Beeper"</font>; }

   <font color=blue>int</font> threadProc()
   {
      <font color=blue>for</font> (;;)
      {
         Beep(_frequency, _duration);
		   _log.logMessage(<font color=red>"INFO"</font>, <font color=red>"Beeped"</font>);
         <font color=blue>for</font> (<font color=blue>int</font> i = 0; i &lt; 20; i++)
         {
            Sleep(500);
            <font color=blue>if</font> (_si.StopFlag)
				{
		         _log.logMessage(<font color=red>"INFO"</font>, <font color=red>"Beeper stopping"</font>);
               <font color=blue>return</font> 0;
			   }
         }
      }
		<font color=blue>return</font> 0;
   }
}

<font color=blue>class</font> BeepService : ServiceImplementation
{
   <font color=blue>this</font>()
   {
      <font color=blue>super</font>(<font color=red>"Beeper"</font>, <font color=red>"BPR"</font>);
   }

   <font color=blue>public</font> WorkerThread getThreadImpl(<font color=blue>int</font> n)
   {
	   <font color=blue>if</font> (n == 0)
			<font color=blue>return</font> <font color=blue>new</font> <u>BeepWorker</u>(200, 500);
      <font color=blue>else</font>
		   <font color=blue>return</font> <font color=blue>new</font> <u>BeepWorker</u>(650, 200);
   }
}

<font color=blue>void</font> main(<font color=blue>char</font>[][] args)
{
    <font color=blue>try</font>
    {
        ServiceImplementation si = <font color=blue>new</font> BeepService();
        ServiceBase.implementMain(args);
    }
    <font color=blue>catch</font> (Exception ex)
    {
        writefln(ex.toString());
    }
}
</pre>
 
<br><br>

<dl></dl>
</dd>
<dt><big>class <u>BeepService</u>: bevutils.serviceimplementation.ServiceImplementation;
</big></dt>
<dd>You must also override class ServiceImplementation to provide appropriate
 information to its constructor, and to provide an implementation for
 getThreadImpl.
 
<br><br>

<dl></dl>
</dd>
<dt><big>void <u>main</u>(char[][] <i>args</i>);
</big></dt>
<dd>Main is completely stereotyped.
<br><br>
The properties file for this service should be as follows:
<pre class="d_code"> &lt;?xml <font color=blue>version</font>=<font color=red>"1.0"</font> ?&gt;
 &lt;Properties layout=<font color=red>"1"</font>&gt;
   &lt;logpath type=<font color=red>"string"</font>&gt;d:<font color=red>\</font>logs&lt;/logpath&gt;
    &lt;numlogs type=<font color=red>"int"</font>&gt;10&lt;/numlogs&gt;
    &lt;maxlogsize type=<font color=red>"int"</font>&gt;1000000&lt;/maxlogsize&gt;
    &lt;threads type=<font color=red>"int"</font>&gt;2&lt;/threads&gt;
 &lt;/Properties&gt;
</pre>
 You could of course put the beep frequencies and durations
 in an int[] in the properties file.
 
<br><br>

</dd>
</dl>

	<hr><small>Page generated by <a href="http://www.digitalmars.com/d/ddoc.html">Ddoc</a>. </small>
	</body></html>
